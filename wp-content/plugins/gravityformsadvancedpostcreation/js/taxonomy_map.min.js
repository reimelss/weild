var GFTaxonomyMap=function(a){var b=this;return b.options=a,b.UI=jQuery("#gaddon-setting-row-"+b.options.fieldName),b.init=function(){b.options.formFields=JSON.parse(b.options.formFields),b.options.preloadedTerms=JSON.parse(b.options.preloadedTerms),b.bindEvents(),b.setupData(),b.setupRepeater()},b.bindEvents=function(){b.UI.on("change",'select[name="_gaddon_setting_'+b.options.keyFieldName+'"]',function(){b.setupRow(jQuery(this).parent().parent(),{})}),b.UI.closest("form").on("submit",function(a){jQuery('[name^="_gaddon_setting_'+b.options.fieldName+'_"]').each(function(a){jQuery(this).removeAttr("name")})})},b.setupData=function(){b.data=jQuery.parseJSON(jQuery("#"+b.options.fieldId).val()),b.data||(b.data=[{key:"",value:"",custom_value:""}])},b.setupRow=function(a,c){var d=a.find('select[name="_gaddon_setting_'+b.options.keyFieldName+'"]'),e=a.find('select[name="_gaddon_setting_'+b.options.valueFieldName+'"]'),f=e.siblings(".custom-value-container");d.select2({minimumResultsForSearch:1/0});var g=(d.siblings(".select2-container"),e.data("select2")?e.siblings(".select2-container"):e);if("gf_custom"===d.val()||"gf_custom"===c.value)g.hide(),f.show();else switch(f.hide(),e.data("select2")&&e.select2("destroy"),e.find("option").each(function(){0!=this.value.length&&jQuery(this).remove()}),d.val()){case"field":e.removeAttr("disabled");var h="";jQuery.each(b.options.formFields,function(a,d){"category"!==b.options.taxonomy&&"post_category"===d.type||(e.append(jQuery("<option>",{value:d.value,text:d.label})),c.value==d.value&&(h=c.value))}),h.length>0&&e.val(h),e.select2();break;case"term":e.removeAttr("disabled"),b.options.preloadedTerms[c.value]&&(e.append(jQuery("<option>",{value:c.value,text:b.options.preloadedTerms[c.value]})),e.val(c.value)),e.select2({ajax:{url:ajaxurl,dataType:"json",delay:250,data:function(a){return{action:"gform_advancedpostcreation_taxonomy_search",taxonomy:b.options.taxonomy,query:a.term}}}}),e.on("select2:selecting",function(a){var c=a.params.args.data;"gf_custom"===c.id&&(e.select2("destroy").hide(),f.show()),b.options.preloadedTerms[c.id]||(b.options.preloadedTerms[c.id]=c.text)});break;default:e.attr("disabled","disabled"),e.select2()}},b.setupRepeater=function(){var a=b.options.limit>0?b.options.limit:0;b.UI.find("tbody.repeater").repeater({limit:a,items:b.data,addButtonMarkup:"<span>+</span>",removeButtonMarkup:"<span>-</span>",callbacks:{add:function(a,c,d){b.setupRow(c,d)},save:function(a,c){jQuery("#"+b.options.fieldId).val(JSON.stringify(c))}}})},b.init()};